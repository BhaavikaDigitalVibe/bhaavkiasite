import{a as nU}from"/build/_shared/chunk-WGU6A3MF.js";import{a as Ae}from"/build/_shared/chunk-SJIB4VAI.js";import{B as $U,C as mU,D as IU,E as zU,F as kU,G as vU,J as Ue,K as ee,L as Be,M as re,N as Pe,O as Je,P as UU,a as oU,b as dU,c as HU,d as VU,e as DU,h as ZU,j as v,p as jU,s as _U,v as OU,w as wU,x as gU}from"/build/_shared/chunk-GX6LHZ7T.js";import{a as WU}from"/build/_shared/chunk-LE7JPKRK.js";import{a as MU}from"/build/_shared/chunk-RF4KE5FM.js";import{b as uU}from"/build/_shared/chunk-TLUPFBOO.js";import{a as xU,c as lU}from"/build/_shared/chunk-HPPG3BMY.js";import{a as GU}from"/build/_shared/chunk-DCJLI3GM.js";import{a as yU,b as EU,d as YU,g as cU,j as y,k as CU}from"/build/_shared/chunk-CG2D626R.js";import{a as Ke,b as NU}from"/build/_shared/chunk-GDLBX7ER.js";import{c as sU}from"/build/_shared/chunk-Q3IECNXJ.js";var Re="/build/_assets/earth-KECVD2W3.glb";var te="/build/_assets/milkyway-nx-B2LSWIPY.hdr";var Te="/build/_assets/milkyway-ny-ABSFT437.hdr";var Qe="/build/_assets/milkyway-nz-L425LJDA.hdr";var se="/build/_assets/milkyway-px-FERHKW3X.hdr";var Ee="/build/_assets/milkyway-py-PLXMGDNB.hdr";var ce="/build/_assets/milkyway-pz-B33EWIJV.hdr";var De="/build/_assets/milkyway-37ER5DRR.jpg";var U=sU(Ke(),1);var X={earth:"eI03r",loader:"FgryW",viewport:"jyNGg",canvas:"_1-1Px",labels:"pWKoQ",label:"MSTaL",vignette:"OZkiK",sections:"RoQEw",section:"uBo-5"};var i=sU(NU(),1),KU={x:0,y:0,z:2},LU=(A,D,n)=>A+n*(D-A),ne=A=>Object.keys(A).map(D=>parseFloat(Math.round(A[D]*100)/100).toFixed(2)).join(", "),aU=A=>!A||!A.camera?KU:{x:A.camera[0],y:A.camera[1],z:A.camera[2]},ye=(A,D)=>{let n=(C=0)=>Math.round((C+Number.EPSILON)*100)/100;return n(A?.x)===n(D?.x)&&n(A?.y)===n(D?.y)&&n(A?.z)===n(D?.z)},iU={stiffness:80,damping:40,mass:2,restSpeed:.001,restDelta:.001},FU={stiffness:40,damping:30,mass:2,restSpeed:.001,restDelta:.001},Ye={stiffness:40,damping:30},Le=(0,U.createContext)({}),TB=({position:A=[0,0,0],scale:D=1,hideMeshes:n=[],labels:C=[],className:_,children:O})=>{let[E,w]=(0,U.useState)(!1),[u,W]=(0,U.useState)(!1),[g,eU]=(0,U.useState)(!1),[$,ae]=(0,U.useState)(!1),L=(0,U.useRef)([]),BU=(0,U.useRef)(),rU=(0,U.useRef)(),M=(0,U.useRef)(),Y=(0,U.useRef)(),b=(0,U.useRef)(),R=(0,U.useRef)(),bU=(0,U.useRef)(),SU=(0,U.useRef)(),PU=(0,U.useRef)(),c=(0,U.useRef)(),m=(0,U.useRef)(),o=(0,U.useRef)(),l=GU(M),I=(0,U.useRef)(),JU=(0,U.useRef)(aU(L.current[0])),z=(0,U.useRef)([]),S=(0,U.useRef)(),AU=(0,U.useRef)(),pU=(0,U.useRef)(),RU=(0,U.useRef)(),{width:d,height:tU}=WU(),k=CU(),f=y(0,iU),h=y(0,iU),N=y(0,iU),H=y(0,FU),V=y(0,FU),Z=y(0,FU),G=y(0,Ye),TU=(0,U.useCallback)(()=>{if(!l){cancelAnimationFrame(I.current);return}I.current=requestAnimationFrame(TU);let B=bU.current.getDelta();o.current.update(B),S.current.update(),b.current.render(Y.current,R.current),z.current.forEach(P=>{let{element:t,position:a,sprite:F}=P,Q=new v(...a),J=R.current.position.distanceTo(c.current.position),s=R.current.position.distanceTo(F.position)>J;Q.project(R.current),Q.x=Math.round((.5+Q.x/2)*window.innerWidth),Q.y=Math.round((.5-Q.y/2)*window.innerHeight),t.style.setProperty("--posX",EU(Q.x)),t.style.setProperty("--posY",EU(Q.y)),s?t.dataset.occluded=!0:t.dataset.occluded=!1})},[l]);(0,U.useEffect)(()=>{RU.current=!0;let{innerWidth:B,innerHeight:P}=window;b.current=new OU({canvas:M.current,antialias:!1,alpha:!0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0}),b.current.setPixelRatio(1),b.current.outputColorSpace=DU,b.current.toneMapping=oU,R.current=new jU(54,B/P,.1,100),R.current.position.x=JU.current.x,R.current.position.y=JU.current.y,R.current.position.z=JU.current.z,R.current.lookAt(0,0,0),f.set(R.current.position.x,!1),h.set(R.current.position.y,!1),N.set(R.current.position.z,!1),Y.current=new wU,bU.current=new IU,PU.current=new kU;let t=new mU(2236962,.05),a=new $U(16777215,1.5);a.position.set(3,0,1);let F=[t,a];return F.forEach(Q=>Y.current.add(Q)),S.current=new vU(R.current,M.current),S.current.enableZoom=!1,S.current.enablePan=!1,S.current.enableDamping=!1,S.current.rotateSpeed=.5,()=>{RU.current=!1,cancelAnimationFrame(I.current),Je(F),re(Y.current),Pe(b.current)}},[]),(0,U.useEffect)(()=>{let B=()=>{W(!0),f.stop(),h.stop(),N.stop()},P=()=>{f.set(R.current.position.x,!1),h.set(R.current.position.y,!1),N.set(R.current.position.z,!1),W(!1)};return S.current.addEventListener("start",B),S.current.addEventListener("end",P),()=>{S.current.removeEventListener("start",B),S.current.removeEventListener("end",P)}},[f,h,N]),(0,U.useEffect)(()=>{if(!E)return;let B=UU("Chunk",c.current),P=UU("Atmosphere",c.current),t=(e,T)=>{R.current.position[e]=T},a=f.on("change",e=>t("x",e)),F=h.on("change",e=>t("y",e)),Q=N.on("change",e=>t("z",e)),J=(e,T)=>{B.position[e]=T},x=H.on("change",e=>J("x",e)),s=V.on("change",e=>J("y",e)),p=Z.on("change",e=>J("z",e)),r=G.on("change",e=>{P.material.opacity=e});return()=>{a(),F(),Q(),x(),s(),p(),r()}},[f,h,N,H,V,Z,E,G]),(0,U.useEffect)(()=>{d<=yU.tablet&&(S.current.enabled=!1)},[d]),(0,U.useEffect)(()=>{if(E)return;let B=new Ue,P=new _U(b.current);P.compileCubemapShader();let t=async()=>{let J=await ee.loadAsync(Re);c.current=J.scene,m.current=J.animations,o.current=new zU(c.current),o.current.timeScale=.1,c.current.traverse(async x=>{let{material:s,name:p}=x;p==="Atmosphere"&&(s.alphaMap=s.map),s&&await b.current.initTexture(s)}),c.current.position.x=A[0],c.current.position.y=A[1],c.current.position.z=A[2],c.current.scale.x=D,c.current.scale.y=D,c.current.scale.z=D},a=async()=>{let J=await B.loadAsync([te,Te,Qe,se,Ee,ce]);J.magFilter=HU,AU.current=P.fromCubemap(J),P.dispose(),await b.current.initTexture(AU.current.texture)},F=async()=>{let J=await Be.loadAsync(De);J.mapping=dU,J.colorSpace=DU,Y.current.background=J,await b.current.initTexture(J)},Q=async()=>{await Promise.all([F(),a(),t()]),c.current.traverse(({material:J})=>{J&&(J.envMap=AU.current.texture,J.needsUpdate=!0)}),RU.current&&w(!0)};(0,U.startTransition)(()=>{Q(),setTimeout(()=>{ae(!0)},1e3)})},[E,A,D]),(0,U.useEffect)(()=>(E&&!pU.current&&(Y.current.add(c.current),pU.current=!0),E&&l&&(eU(!0),TU()),()=>{cancelAnimationFrame(I.current)}),[TU,l,E]),(0,U.useEffect)(()=>{E&&(rU.current.innerHTML="",z.current=C.map(B=>{let P=document.createElement("div");P.classList.add(X.label),P.dataset.hidden=!0,P.style.setProperty("--delay",`${B.delay||0}ms`),P.textContent=B.text,rU.current.appendChild(P);let t=new gU;return t.position.set(...B.position),t.scale.set(60,60,1),{element:P,...B,sprite:t}}))},[C,E]),(0,U.useEffect)(()=>{b.current.setSize(d,tU),R.current.aspect=d/tU,R.current.updateProjectionMatrix()},[d,tU]),(0,U.useEffect)(()=>{let B=M.current,P=t=>{let{innerWidth:a,innerHeight:F}=window,Q=ne(R.current.position);console.info({cameraPosition:Q}),SU.current=new ZU(t.clientX/a*2-1,-(t.clientY/F)*2+1),PU.current.setFromCamera(SU.current,R.current);let J=PU.current.intersectObjects(Y.current.children,!0);if(J.length>0){let x=ne(J[0].point);console.info({clickPosition:x})}};return()=>{B.removeEventListener("click",P)}},[]);let qU=(0,U.useCallback)(()=>{if(!BU.current)return;let{offsetTop:B}=BU.current,{innerHeight:P}=window,t=window.scrollY-B,a,F=s=>{let p=L.current[s].meshes;c.current.traverse(r=>{let{name:e}=r,T=UU("Chunk",c.current),K=p?.includes(e),j=n?.includes(e);if(K)if(e==="Atmosphere")r.visible=!0,G.set(1);else if(e==="Chunk"){let q=new v(-.4,.4,.4);r.visible=!0,k?r.position.set(...q.toArray()):(H.set(q.x),V.set(q.y),Z.set(q.z))}else e==="EarthFull"&&T.visible?r.visible=!1:r.visible=!0;else if(j&&!K)if(e==="Atmosphere")G.set(0);else if(e==="Chunk"){let q=new v(0,0,0);ye(q,T.position)&&(r.visible=!1),H.set(q.x),V.set(q.y),Z.set(q.z)}else e==="EarthPartial"&&T.visible?r.visible=!0:r.visible=!1})},Q=s=>{let p=L.current[s].animations;k||(m.current.forEach((r,e)=>{p.find(T=>T.includes(e.toString()))||o.current.clipAction(r).reset().stop()}),m.current.length&&L.current[s].animations&&p.forEach(r=>{let e=r.split(":"),T=m.current[Number(e[0])],K=o.current.clipAction(T);(!e[1]||e[1]!=="loop")&&(K.clampWhenFinished=!0,K.loop=VU),K.play()}))},J=s=>{z.current.forEach(r=>{r.hidden&&(r.element.dataset.hidden=!0,r.element.setAttribute("aria-hidden",!0))}),L.current[s].labels.forEach(r=>{z.current.filter(T=>T.text===r).forEach(T=>{T.element.dataset.hidden=!1,T.element.setAttribute("aria-hidden",!1)})})};requestAnimationFrame(()=>{let s=L.current.length-1,p=Math.floor(t/P),r=nU(p,0,s),e=L.current[r],T=L.current[r+1],K=aU(e)||KU,j=aU(T)||KU,q=(t-P*r)/P,QU=nU(q,0,1),XU=LU(K.x,j.x,QU),fU=LU(K.y,j.y,QU),hU=LU(K.z,j.z,QU);if(a!==K&&L.current.length&&e&&(F(r),Q(r),J(r)),a=K,!u){if(k){R.current.position.set(XU,fU,hU);return}f.set(XU),h.set(fU),N.set(hU)}})},[f,h,N,H,V,Z,u,n,G,k]);(0,U.useEffect)(()=>{let B=Ae(qU,100);return E&&l&&window.addEventListener("scroll",B),()=>{window.removeEventListener("scroll",B)}},[qU,l,E,G]);let ie=(0,U.useCallback)(B=>{L.current=[...L.current,B]},[]),Fe=(0,U.useCallback)(B=>{L.current=L.current.filter(P=>P!==B)},[]);return(0,i.jsx)(Le.Provider,{value:{registerSection:ie,unregisterSection:Fe},children:(0,i.jsxs)("div",{className:cU(X.earth,_),ref:BU,children:[(0,i.jsxs)("div",{className:X.viewport,children:[(0,i.jsx)("canvas",{className:X.canvas,"data-visible":E&&g,"data-grabbing":u,ref:M}),(0,i.jsx)("div",{className:X.labels,"aria-live":"polite",ref:rU}),(0,i.jsx)("div",{className:X.vignette})]}),(0,i.jsx)("div",{className:X.sections,children:O}),(0,i.jsx)(lU,{unmount:!0,in:!E&&$,timeout:YU(xU.base.durationL),children:B=>(0,i.jsx)(MU,{className:X.loader,"data-visible":B,children:(0,i.jsx)(uU,{})})})]})})},QB=(0,U.memo)(({children:A,scrim:D,scrimReverse:n,className:C,camera:_=[0,0,0],animations:O=[],meshes:E=[],labels:w=[]})=>{let{registerSection:u,unregisterSection:W}=(0,U.useContext)(Le),g=(0,U.useRef)(),eU=JSON.stringify(O)+JSON.stringify(_)+JSON.stringify(w)+JSON.stringify(E);return(0,U.useEffect)(()=>{let $={camera:_,animations:O,meshes:E,labels:w,sectionRef:g};return u($),()=>{W($)}},[eU,u,W]),(0,i.jsx)("div",{className:cU(X.section,C),"data-scrim":D,"data-scrim-reverse":n,ref:g,children:A})});export{TB as Earth,QB as EarthSection};
